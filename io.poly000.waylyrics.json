{
    "app-id": "io.poly000.waylyrics",
    "runtime": "org.gnome.Platform",
    "runtime-version": "46",
    "sdk": "org.gnome.Sdk",
    "sdk-extensions": ["org.freedesktop.Sdk.Extension.rust-stable"],
    "command": "waylyrics",
    "finish-args": [
        "--socket=wayland",
        "--socket=fallback-x11",
        "--device=dri",
        "--share=ipc",
        "--filesystem=xdg-data:ro",
        "--filesystem=xdg-cache:rw",
        "--filesystem=xdg-config:rw",
        "--env=GTK_PATH=/app/lib/gtk-4.0"
    ],
    "build-options": {
        "append-path": "/usr/lib/sdk/rust-stable/bin"
    },
    "modules": [{
        "name": "waylyrics",
        "buildsystem": "simple",
        "build-options": {
            "env": {
                "CARGO_HOME": "/run/build/waylyrics/cargo"
            }
        },
        "build-commands": [
            "cargo --offline fetch --manifest-path Cargo.toml --verbose",
            "WAYLYRICS_THEME_PRESETS_DIR=/app/share/waylyrics/themes/ cargo --offline build --release --verbose",
            "install -Dm755 ./target/release/waylyrics -t /app/bin/",
            "install -Dm644 io.poly000.waylyrics.desktop -t /app/share/applications/",
            "install -Dm644 io.poly000.waylyrics.gschema.xml -t /app/share/glib-2.0/schemas/",
            "glib-compile-schemas /app/share/glib-2.0/schemas/",
            "install -Dm644 themes/*.css -t /app/share/waylyrics/themes/",
            "for locale in locales/*/LC_MESSAGES/waylyrics.po; do \
                echo \"Installing locale ${locale}...\" \
                mo=${locale/#locales\//} \
                mo=${mo/%.po/.mo} \
                msgfmt ${locale} -o - | install -Dm644 /dev/stdin /app/share/locale/${mo} \
            done",
            "cp -r res/icons/ /app/share/"
        ],
        "sources": [
            {
                "type": "archive",
                "url": "https://github.com/waylyrics/waylyrics/archive/refs/tags/v0.2.21.tar.gz",
                "sha256": "aa3cb37821a898581c464214f2238d3c4d0dafbdb9caaa69ec1a50f9b8032a70"
            },
            "cargo-sources.json"
        ]
    }]
}
